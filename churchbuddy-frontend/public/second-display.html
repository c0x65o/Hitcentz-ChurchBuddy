<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChurchBuddy - Second Display</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        
        #slide-container {
            width: 1920px;
            height: 1080px;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .slide-content {
            width: 100%;
            height: 100%;
            background: #000;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            text-align: center;
            padding: 40px;
            box-sizing: border-box;
        }
        
        .waiting {
            color: #666;
            font-size: 24px;
            text-align: center;
        }
        
        /* Slide content styling to match SlideRenderer */
        .slide-content div {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .slide-content img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .slide-content video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div id="slide-container">
        <div id="slide-content" class="waiting">
            Waiting for slide data...
        </div>
    </div>

    <script>
        // Listen for slide data from the main window
        window.addEventListener('message', function(event) {
            if (event.data.type === 'SLIDE_DATA' && event.data.slide) {
                const slide = event.data.slide;
                const slideContainer = document.getElementById('slide-content');
                
                // Apply background if present
                const backgroundMatch = slide.html.match(/<!--BACKGROUND:(.*?)-->/);
                if (backgroundMatch) {
                    const backgroundUrl = backgroundMatch[1];
                    slideContainer.style.backgroundImage = `url(${backgroundUrl})`;
                    slideContainer.style.backgroundSize = 'cover';
                    slideContainer.style.backgroundPosition = 'center';
                    slideContainer.style.backgroundRepeat = 'no-repeat';
                } else {
                    slideContainer.style.backgroundImage = 'none';
                }
                
                // Set the slide HTML content
                slideContainer.innerHTML = slide.html;
                slideContainer.className = 'slide-content';
                
                // Handle video playback for active slides
                const youtubeIframes = slideContainer.querySelectorAll('iframe[src*="youtube.com"]');
                youtubeIframes.forEach((iframe) => {
                    const iframeElement = iframe;
                    // Ensure autoplay and unmute for active slide
                    if (!iframeElement.src.includes('autoplay=1')) {
                        const separator = iframeElement.src.includes('?') ? '&' : '?';
                        iframeElement.src = `${iframeElement.src}${separator}autoplay=1&mute=0`;
                    } else if (iframeElement.src.includes('mute=1')) {
                        // Replace mute=1 with mute=0
                        iframeElement.src = iframeElement.src.replace('mute=1', 'mute=0');
                    }
                });

                // Handle native video elements
                const videoElements = slideContainer.querySelectorAll('video');
                videoElements.forEach((video) => {
                    // Unmute and play for active slide
                    video.muted = false;
                    video.play().catch((error) => {
                        console.log('Video play failed:', error);
                    });
                });
            }
        });

        // Request slide data when page loads
        window.addEventListener('load', function() {
            if (window.opener) {
                window.opener.postMessage({
                    type: 'REQUEST_SLIDE_DATA'
                }, '*');
            }
        });
    </script>
</body>
</html> 